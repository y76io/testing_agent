{% extends 'layout.html' %}
{% block content %}
  <h2 style="margin:0;">Metric Evaluation Results</h2>
  <p style="color:var(--muted);">Run: {{ run_id }} — Metric: {{ metric_id }}</p>
  <div class="card-inner">
    <p><strong>Conversations:</strong> {{ summary.count }} — <strong>Mean score:</strong> {{ '%.3f'|format(summary.mean or 0.0) }} — <strong>Failures:</strong> {{ summary.failed_count }}</p>
  </div>
  <div style="height:10px;"></div>
  <div class="card-inner">
    <h3 style="margin:0 0 8px;">Per-conversation</h3>
    <table>
      <thead><tr><th>#</th><th>Score</th><th>Pass</th><th>Reason</th><th>How to improve</th></tr></thead>
      <tbody>
        {% for row in per_conversation %}
        <tr>
          <td>{{ row.idx }}</td>
          <td>{{ '%.3f'|format(row.score or 0.0) }}</td>
          <td>{{ row.pass }}</td>
          <td style="max-width:420px; white-space:normal;">{{ row.explanation or '' }}</td>
          <td style="max-width:420px; white-space:normal;">
            {% if row.improvements and row.improvements|length %}
              <ul style="margin:.25rem 0 0 1rem;">
                {% for s in row.improvements %}<li>{{ s }}</li>{% endfor %}
              </ul>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if eval_id %}
  <div style="margin-top:12px; text-align:right;">
    <a class="btn secondary" href="/ui/plan?eval_id={{ eval_id }}">Main evaluation</a>
  </div>
  {% endif %}
{% endblock %}
