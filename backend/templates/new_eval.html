{% extends 'layout.html' %}
{% block content %}
  <h2>New Blackbox API Evaluation</h2>
  {% if error %}<p class="error">{{ error }}</p>{% endif %}
  <form method="post" action="/ui/new{% if eval_id %}?eval_id={{ eval_id }}{% endif %}" onsubmit="showLoading()">
    <label>System ID</label>
    <input name="system_id" required placeholder="my_agent_api">

    <label>Name (optional)</label>
    <input name="name" placeholder="Display name">

    <label>Endpoint URL</label>
    <input name="endpoint" required placeholder="https://api.example.com/chat">

    <label>HTTP Method</label>
    <select name="method">
      <option>POST</option>
      <option>GET</option>
    </select>

    <label>Headers JSON</label>
    <textarea name="headers_json" rows="6">{ "content-type": "application/json" }</textarea>

    <label>Request Body JSON</label>
    <textarea name="body_json" rows="12">{
  "output_type": "chat",
  "input_type": "chat",
  "tweaks": {
    "ChatInput-tqPPD": {
      "input_value": "${input}"
    }
  }
}</textarea>

    <label>Test Prompt</label>
    <input name="test_prompt" value="Hello" />

    <div style="display:flex; gap: 16px; align-items:center; flex-wrap:wrap; margin-top: 1rem;">
      <label style="display:flex; align-items:center; gap:6px; margin-top:0;">
        <input type="checkbox" name="add_api_key" value="1" />
        Add API key header
      </label>
      <input name="api_key_name" placeholder="Header name (e.g., x-api-key)" style="max-width:260px;">
      <input name="api_key_value" placeholder="Key value" style="max-width:320px;">
    </div>

    <div style="display:flex; gap: 16px; align-items:center; flex-wrap:wrap; margin-top: .5rem;">
      <label style="display:flex; align-items:center; gap:6px; margin-top:0;">
        <input type="checkbox" name="add_session_id" value="1" />
        Add session_id to body
      </label>
      <input name="session_id_field" value="session_id" style="max-width:240px;">
    </div>

    <div style="margin-top:1rem;">
      <button class="btn" type="submit">Detect Mapping & Run Test</button>
    </div>
  </form>
{% endblock %}
