{% extends 'layout.html' %}
{% block content %}
  <h2 style="margin-top:0;">Evaluation Sections — {{ standard_name }}</h2>
  <p style="color:var(--muted);">Sections grouped by evaluation mode and access. Only Black-Box API is active for now.</p>
  <div style="display:grid; grid-template-columns: 1fr; gap: 14px;">
    {% for g in groups %}
    <div class="card">
      <h3 style="margin:0 0 10px;">{{ g.evaluation_mode }}</h3>
      <div style="display:grid; grid-template-columns: 1fr; gap: 10px;">
        {% for ag in g.access_groups %}
        <div class="card-inner">
          <div style="font-weight:600; margin-bottom:6px;">{{ ag.access }}</div>
          <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap:10px;">
            {% for it in ag['items'] %}
              <div class="card-inner" style="background:#0b1a2b;">
                <div style="font-weight:600;">{{ it.id }} — {{ it.name }}</div>
                {% set first_link = (it.links[0].id if it.links and it.links|length > 0 else None) %}
                <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
                  <a class="btn" href="/ui/eval?eval_id={{ eval_id }}&item_id={{ it.id }}&mode={{ g.evaluation_mode }}&access={{ ag.access }}{% if first_link %}&metric_id={{ first_link }}{% endif %}">Open {{ g.evaluation_mode }} — {{ ag.access }}</a>
                  {% if it.links and it.links|length > 0 %}
                    <span style="color:var(--muted);">Links: {{ it.links|length }}</span>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% else %}
      <p>No sections selected.</p>
    {% endfor %}
  </div>
{% endblock %}
